<!DOCTYPE html>
<html>
    <head>
        <title>Bruteforce Heat Map</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="style.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
        <script src="heatmap.js"></script>
        <script src="leaflet-heatmap.js"></script>
    </head>
    <body>
        <h1>SSH Bruteforce Map</h1>
        <div id="map"></div>
        <script>
            var Jawg_Matrix = L.tileLayer('https://{s}.tile.jawg.io/jawg-matrix/{z}/{x}/{y}.png?access-token={accessToken}', {
                attribution: '<a href="http://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                minZoom: 3,
                maxZoom: 22,
                accessToken: 'robwSG8HiMYNPewxsT3oytycdnlivt23wW3EZvNk9a9V3yU6pj9QhnTtNVIovcVw'
            });

            var cfg = {
                "radius": 2,
                "maxOpacity": .8,
                "scaleRadius": true,
                "useLocalExtrema": true,
                latField: 'lat',
                lngField: 'lng',
                valueField: 'count'
            };

            var map = new L.Map('map', {
                center: new L.LatLng(25, 0),
                zoom: 2,
                layers: [Jawg_Matrix]
            });

            var icon = L.icon({
                iconUrl: 'https://img.icons8.com/color/48/000000/marker--v1.png',
                iconSize: [17.5, 20],
                iconAnchor: [8.75, 0]
            });

            function setMarker(data) {
                var popup = `IP: ${data.ip}\nAttempts: ${data.attempts}`;
                L.marker([data.lat, data.lng], {icon: icon}).addTo(map).bindPopup(popup);
            }

            function setMarkers(data) {
                let n = data.n;
                let start = 0;
                if (n >= 100)
                    start = n - 100;

                for (let i = start; i < n; i++) {
                    fetch('/geoip/' + i)
                        .then(res => res.json())
                        .then(data => setMarker(data))
                }
            }

            fetch("/geoip/length")
                .then(res => res.json())
                .then(data => setMarkers(data))
        </script>
    </body>
</html>
