<!DOCTYPE html>
<html>
    <head>
        <title>Bruteforce Heat Map</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
        <link rel="stylesheet" href="style.css" />
        <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
        <script src="heatmap.js"></script>
        <script src="leaflet-heatmap.js"></script>
    </head>
    <body>
        <h1>SSH Bruteforce Map</h1>
        <div id="map"></div>
        <script>
            var Jawg_Matrix = L.tileLayer('https://{s}.tile.jawg.io/jawg-matrix/{z}/{x}/{y}.png?access-token={accessToken}', {
                attribution: '<a href="http://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                minZoom: 2,
                maxZoom: 22,
                accessToken: 'robwSG8HiMYNPewxsT3oytycdnlivt23wW3EZvNk9a9V3yU6pj9QhnTtNVIovcVw'
            });

            var cfg = {
                "radius": 2,
                "maxOpacity": .8,
                "scaleRadius": true,
                "useLocalExtrema": true,
                latField: 'lat',
                lngField: 'lng',
                valueField: 'count'
            };

            var map = new L.Map('map', {
                center: new L.LatLng(25, 0),
                zoom: 2,
                layers: [Jawg_Matrix]
            });

            var logs = []

            function setMarkers() {
                for (key of Object.keys(logs)) {
                    var popup = `IP: ${key}\nAttempts: ${logs[key]['attempts']}`;
                    L.marker([logs[key]['lat'], logs[key]['lng']]).addTo(map).bindPopup(popup);
                }
            }

            fetch("http://localhost:3000/geoip")
                .then(res => res.json())
                .then(data => logs = data)
                .then(() => setMarkers())
        </script>
    </body>
</html>
